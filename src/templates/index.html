<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>开始使用layui</title>
  <link rel="stylesheet" href="static/layui/css/layui.css">
	<script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery
/jquery-1.4.min.js"></script>
<!--   <script type="text/javascript" src="static/myindex.js"></script>
 -->  <script src="static/layui/layui.js"></script>
  <script src="static/index.js"></script>
</head>



<body>

<!-- 你的HTML代码 -->
 


<div id="hello">Hello</div>

<button type="button" class="layui-btn" id="test3"><i class="layui-icon"></i>上传文件</button>

<table class="layui-hide" id="test" lay-filter="test"></table>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
  <legend>图片懒加载</legend>
</fieldset>
<div class="site-demo-flow" id="LAY_demo3">
<!--   <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/701696736/TB2PNl5ahQa61Bjy0FhXXaalFXa_!!701696736.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/162734861/TB2V5rsX_gc61BjSZFkXXcTkFXa_!!162734861.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i4/69476562/TB2htq4XTka61BjSszfXXXN8pXa_!!69476562.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i1/180558071/TB2sy6jXMQc61BjSZFGXXa1DFXa_!!180558071.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/701696736/TB2PNl5ahQa61Bjy0FhXXaalFXa_!!701696736.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i3/285892163/TB2qu2HX9Zb61BjSZPfXXaU.pXa_!!285892163.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/704998060/TB2S.gAXTgc61BjSZFkXXcTkFXa_!!704998060.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i3/117202952/TB25lckX_AX61Bjy0FcXXaSlFXa_!!117202952.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/162734861/TB2qijoX9Zb61BjSZPfXXaU.pXa_!!162734861.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i3/96216586/TB2S7EfXHMc61BjSZFFXXaDLFXa_!!96216586.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i8/TB1jSSFNFXXXXcoXFXXYXGcGpXX_M2.SS2_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/162734861/TB2ylbsX37c61BjSZFKXXb6hFXa_!!162734861.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i2/117202952/TB2FdyZajUd61BjSZPcXXc6hXXa_!!117202952.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i4/777105914/TB2t.qbXZwb61Bjy0FfXXXvlpXa_!!777105914.jpg_400x400q90.jpg?t=1615283254210">
  <img lay-src="https://gw.alicdn.com/bao/uploaded/i4/TB1XzupNFXXXXcpXXXXXXXXXXXX_!!0-item_pic.jpg_400x400q90.jpg?t=1615283254210">
 --></div>

<div id="pics">this is screencaps</div>




 <script type="text/javascript">
$(document).ready(function(){
console.log("this is in jquery");
});

document.getElementById("hello").onclick = function(){
	console.log("helloclic");
}

 layui.use('table', function(){
  var table = layui.table;
  
  table.render({
    elem: '#test'
    ,url:'/getdata'
    ,limit: 10
    ,cols: [[ //表头
      {field: 'sha1', title: 'sha1', width:200}
      ,{field: 'pkg', title: '包名', width:200, sort: true}
      ,{field: 'cert', title: '证书', width:200}
      ,{field: 'dn', title: 'dn', width: 100, sort: true}
      ,{field: 'vername', title: '版本', width: 100, sort: true}
      ,{field: 'appname', title: '应用名称', width: 100}
      ,{field: 'add_time', title: '记录时间', width: 135, sort: true}
    ]]
    ,page: true
  });
  
  //监听行单击事件（双击事件为：rowDouble）
  table.on('row(test)', function(obj){
  	// location.reload();

  	// window.location.href="https://www.baidu.com"
    var data = obj.data;
    console.log(data["sha1"]);
    console.log("/apk/screencaps?"+data["sha1"]);

    console.log(JSON.stringify(data));
    
    // layer.alert(JSON.stringify(data), {
    //   title: '当前行数据：'
    // });
    
    // //标注选中样式
    // obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');


	var xmlhttp;
	if (window.XMLHttpRequest)
	{
	    //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
	    xmlhttp=new XMLHttpRequest();
	}
	else
	{
	    // IE6, IE5 浏览器执行代码
	    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	}
		xmlhttp.onreadystatechange=function()
	{
		if (xmlhttp.readyState==4 && xmlhttp.status==200)
		{	
			var retstr =  xmlhttp.responseText;
			var retobj = JSON.parse(retstr)
			// console.log(retobj["data"]);

			// var parent = document.getElementById("pics");
			// for(var i=0;i<parent.childNodes.length;i++){
			// 	parent.removeChild(i)
			// }


			for(var i=0;i<retobj["data"].length;i++){
				console.log(retobj["data"][i])
				console.log(retobj["data"][i].split("/")[4])
				var img=document.createElement("img");
				img.src=retobj["data"][i];
				img.height = "600"
				img.width = "400"
				img.className = "screencap"
				picname =  retobj["data"][i].split("/")[4];
				// img.addEventListener("click", searchpic(picname), false);
				// img.onclick="searchpic";
				document.getElementById("LAY_demo3").appendChild(img);
			}
			//绑定 事件
			$(".screencap").click(function(){
				var src = $(this).attr("src");
				console.log(src)
			});
			// console.log(typeof(ret));
			// console.log(ret);



		}
	}
	xmlhttp.open("get",  "/apk/screencaps?sha1="+data["sha1"], true);
	xmlhttp.send();
	// console.log(xmlhttp.responseText);	



  });
  
});



layui.use('flow', function(){
  var flow = layui.flow;
 
  flow.load({
    elem: '#LAY_demo1' //流加载容器
    ,scrollElem: '#LAY_demo1' //滚动条所在元素，一般不用填，此处只是演示需要。
    ,done: function(page, next){ //执行下一页的回调
      
      //模拟数据插入
      setTimeout(function(){
        var lis = [];
        for(var i = 0; i < 8; i++){
          lis.push('<li>'+ ( (page-1)*8 + i + 1 ) +'</li>')
        }
        
        //执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
        //pages为Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
        next(lis.join(''), page < 10); //假设总页数为 10
      }, 500);
    }
  });
  
  flow.load({
    elem: '#LAY_demo2' //流加载容器
    ,scrollElem: '#LAY_demo2' //滚动条所在元素，一般不用填，此处只是演示需要。
    ,isAuto: false
    ,isLazyimg: true
    ,done: function(page, next){ //加载下一页
      //模拟插入
      setTimeout(function(){
        var lis = [];
        for(var i = 0; i < 6; i++){
          lis.push('<li><img lay-src="//s17.mogucdn.com/p2/161011/upload_279h87jbc9l0hkl54djjjh42dc7i1_800x480.jpg?v='+ ( (page-1)*6 + i + 1 ) +'"></li>')
        }
        next(lis.join(''), page < 6); //假设总页数为 6
      }, 500);
    }
  });
  
  //按屏加载图片
  flow.lazyimg({
    elem: '#LAY_demo3 img'
    ,scrollElem: '#LAY_demo3' //一般不用设置，此处只是演示需要。
  });
  
});


</script>
</body>
</html>